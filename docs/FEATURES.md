# 기능 정리 — 작업 환경·저장·버전·슬롯

현재 구현된 기능과, **작업 환경(저장·버전·슬롯)** 구조를 한곳에 정리한 문서입니다.

---

## 0. 진행 단계 및 검토

### 현재 단계
- **지금**: 프로젝트 동작이 이뤄지는 **전체 레이아웃 기반**을 만드는 단계.
- **레이아웃 기반**: 헤더(타이틀 + 모드 전환) → 작업영역 바(슬롯·저장 예정) → 본문(배치·테스트 / 시뮬레이션).  
  이 구조 위에 슬롯·저장·버전 UI를 단계적으로 추가합니다.

### 적용 여부 검토 (최근)

| 항목 | 상태 | 비고 |
|------|------|------|
| 3단 레이아웃 (헤더 / 작업영역 바 / 본문) | ✅ 적용 | App.tsx, App.css |
| Slot, SlotVersion, WorkspaceState 타입 | ✅ 적용 | src/models/types.ts |
| workspace 로컬 스토리지 (load/save/createSlot/updateSlot) | ✅ 적용 | src/workspace/ |
| GitHub 기준 logistics-sim, base 경로 | ✅ 적용 | vite.config.ts, README, docs/PROJECT.md |
| README(소개) vs docs(작업용) 분리 | ✅ 적용 | README.md, docs/PROJECT.md, FEATURES.md |
| 배치 모드 ↔ 슬롯 연동 | ✅ 적용 | App에서 workspace 연동, LayoutMode에 layout/onLayoutChange 전달 |

### 완료한 단계 (최근 작업)
1. **작업영역 바** `WorkspaceBar`: 슬롯 선택(select)·새 슬롯·저장·삭제 버튼.
2. **App**: workspace 상태(loadWorkspace 초기값), 현재 슬롯 derived, 저장 시 `saveWorkspace(workspace)` 호출.
3. **LayoutMode**: `layout`, `onLayoutChange` props로 현재 슬롯 배치 표시·편집, 변경 시 workspace 메모리 갱신 → **저장** 클릭 시 로컬 스토리지 반영.

### 완료한 단계 (슬롯 이름·버전)
- **슬롯 이름 편집**: 작업영역 바에서 슬롯 선택 후 ✎ 클릭 → 입력 후 Enter/Blur로 반영. `updateSlot(slot, { name })` 지원.
- **버전 저장**: 현재 슬롯 상태를 "버전"으로 저장 (버전 저장 버튼). 슬롯당 최대 20개 유지.
- **버전 목록·복원**: "버전 (N)" 클릭 시 목록 표시, 항목별 "복원"으로 해당 시점 layout으로 되돌림.

### 피드백 반영 (최근)
- **확대/축소**: 그리드 툴바에 − / 100% / + 로 25%～200% 줌. 셀 크기 조절로 여러 칸 한눈에 보기 가능.
- **그리드·기능 패널**: 웹 기준 그리드는 **정사각형 셀**(32px)로 고정, 전체 width 점령하지 않음. **상단**·**사이드**에 기능 패널 영역 추가(추후 활용).
- **장비**: 입고, 출고, 컨베이어, **기계1** 네 가지로 통일. (보관·가공은 타입 호환용 유지.)
- **GitHub Pages 배치·저장**: 슬롯이 없을 때 배치/저장이 무시되던 문제 → **슬롯 0개일 때 자동으로 "슬롯 1" 생성**하여 첫 방문·GH Pages에서도 배치·저장 가능.
- **버전 저장**: "버전 저장" 클릭 시 **즉시 로컬 스토리지에 반영** (별도 "저장" 버튼 불필요). GitHub Pages에서도 동일.
- **기본 그리드**: **32×32**로 설정. (신규 슬롯·빈 레이아웃 기준. 기존 저장 데이터는 기존 행/열 유지.)
- **컨베이어**: 시뮬레이션 연계를 위해 **연결의 형태**로 인지. **이동 방향**(0/90/180/270° = →↓←↑) 설정 가능. 배치 전 방향 선택, 배치된 컨베이어 클릭 시 방향만 순환.

### 향후 기계 사양 (인지)
- 기계는 추후 **기계별 크기**(그리드 칸 수), **입출력 포트 위치·개수** 등을 고정해 두고 확장할 예정. 당장 구현이 아니어도 설계 시 반영.

---

## 1. 현재 기능 (이미 구현된 것)

| 구분 | 내용 |
|------|------|
| **전체 레이아웃** | 헤더 → 작업영역 바(슬롯·이름 편집·저장·버전·삭제) → 본문 3단 구조 |
| **모드 전환** | 상단에서 「배치·테스트」 / 「시뮬레이션」 전환 |
| **배치·테스트** | 그리드: 입고/출고/컨베이어/기계1, 정사각형 셀·줌·상단/사이드 패널. 배치·삭제·저장(슬롯 1 자동 생성) |
| **시뮬레이션** | 설명 + Phase 2 준비용 플레이스홀더 |
| **반응형** | 웹·모바일 공통 레이아웃, 뷰포트 대응 |
| **배포** | GitHub Pages (`/logistics-sim/`), GitHub Actions 자동 배포 |

---

## 2. 작업 환경이란 (목표)

- **한 사람이 여러 시나리오**를 각각 작업할 수 있고  
- **여러 사람이 각자 작업**할 수 있도록  
**저장·버전·슬롯**으로 구조를 나눕니다.

| 개념 | 설명 |
|------|------|
| **작업 환경** | 현재 선택된 슬롯 + 슬롯 목록 + (선택) 버전 히스토리 |
| **슬롯** | 배치/시나리오 하나를 담는 단위. 이름·배치·시뮬 설정 포함 |
| **저장** | 현재 슬롯의 배치·설정을 디스크(로컬 또는 서버)에 남김 |
| **버전** | 같은 슬롯 안에서 과거 저장 상태를 유지·복원 |

---

## 3. 슬롯 관리

- **슬롯** = 한 가지 “작업 공간” (예: A창고 배치, B창고 배치, 테스트용).
- 슬롯마다 **이름**, **생성/수정 일시**, **현재 배치(LayoutMap)**, **(선택) 시뮬 설정**을 가짐.
- 사용자 동작:
  - **슬롯 선택**: 작업할 슬롯을 고르면 해당 배치/설정이 화면에 로드됨.
  - **새 슬롯**: 빈 배치로 새 슬롯 생성 후 이름 지정.
  - **슬롯 삭제**: 필요 시 삭제 (확인 후).
  - **슬롯 복제**: 기존 슬롯을 복사해 새 슬롯으로 저장 (선택 기능).

저장소는 우선 **로컬(브라우저)** 기준으로 하고, 나중에 서버 연동 시 같은 데이터 구조를 사용할 수 있도록 설계.

---

## 4. 저장

- **저장** = 현재 선택된 슬롯의 `layout`(+ 필요 시 `simulationConfig`)을 영구 저장.
  - 1차: **로컬 스토리지** (같은 브라우저·같은 기기).
  - 이후: 서버 API 연동 시 해당 슬롯을 서버에 저장.
- **자동 저장**: 주기적 또는 “배치 변경 시” 자동 저장 옵션 (Phase 2 등에서 고려).
- **다른 이름으로 저장**: 현재 슬롯을 새 이름의 슬롯으로 복사해 저장 (슬롯 추가).

---

## 5. 버전 관리

- **버전** = 한 슬롯에 대해 “그 시점의 스냅샷”을 남긴 것.
- 각 버전: **저장 시각**, **선택 메모(라벨)**, **그 시점의 layout(및 설정)**.
- 사용자 동작:
  - **버전 만들기**: 현재 상태를 “버전”으로 남김 (이름/메모 선택).
  - **버전 목록 보기**: 해당 슬롯의 과거 버전 목록 조회.
  - **이전 버전으로 복원**: 선택한 버전을 현재 슬롯 상태로 되돌림.

**적용됨**: 버전 저장(`addVersion`), 버전 목록·복원 UI(작업영역 바 "버전 (N)" 드롭다운), 슬롯당 최대 20개 버전 유지.

---

## 6. 데이터 구조 요약

- **WorkspaceState**: `currentSlotId`, `slots[]`, (선택) `versionsBySlotId`
- **Slot**: `id`, `name`, `createdAt`, `updatedAt`, `layout`, `simulationConfig?`
- **SlotVersion**: `id`, `slotId`, `savedAt`, `label?`, `layout`, `simulationConfig?`

타입 정의는 `src/models/types.ts`, 저장/불러오기 골격은 `src/workspace/` 에 두었습니다.

---

## 7. UI 배치 (제안)

- **헤더 또는 사이드**: “현재 슬롯” 표시 + 슬롯 전환 드롭다운(또는 목록).
- 같은 영역 또는 툴바: **새 슬롯**, **저장**, **(Phase 2) 다른 이름으로 저장**, **(Phase 2) 버전 목록 / 복원**.
- 배치·테스트 / 시뮬레이션 모드는 **현재 슬롯의 데이터**를 기준으로 동작.

이렇게 하면 “작업 환경 + 저장 + 버전 + 슬롯”이 한 번에 정리되고, 여러 사람·여러 시나리오를 같은 앱에서 구분해 쓸 수 있습니다.
