# 전체 구조 정리

구현에 앞서 **데이터·개념 구조**를 고정해 두는 문서입니다.

---

## 0. Phase 1과 Phase 2의 역할

- **Phase 2 시뮬레이션**은, Phase 1 배치 모드에서 만든 레이아웃을 기준으로 **물자의 이동을 시간에 따라 보여 주는 것**입니다. 즉 **같은 물류 규칙**을 쓰는 다른 뷰입니다.
- 따라서 **Phase 1에서 물류 시스템의 구조·작동 방식·흐름을 온전히 갖춰 두어야** 하고,  
  **테스트(물품 1개 흐름)** 와 **시뮬레이션(시간·다량·지표)** 은 **동일한 흐름 규칙**을 공유합니다.
- **Phase 1**: 구조·작동·흐름 완성 (다칸 장비, 입출력 포트, 창고·출고 선택, 기계 변환 등 규칙 + 하나의 flow 모델).
- **Phase 2**: 그 위에 **시간축**, **다량 물품**, **처리량·대기 시간 지표**, **재생/일시정지 UI** 등을 얹는 단계.

---

## 1. 방향전환의 의미

**방향전환**은 “한 셀의 방향을 상하좌우로 바꾸는 것”이 아니라, **경로가 한 셀을 지날 때 진입 방향과 이탈 방향이 다른 경우**를 말합니다.

- 예: **A2 → A3 → B3** 로 물품이 이동할 때,
  - **A3**에서: A2에서 들어왔고(진입), B3로 나간다(이탈).
  - 즉 A3는 **진입 방향과 이탈 방향이 다른 셀** = **방향전환(코너)**.
- 컨베이어 한 칸에서 **입력 방향 ≠ 출력 방향**이면 그 칸이 방향전환점으로 해석합니다.

---

## 2. 장비가 여러 칸을 차지

- 장비는 **1칸**일 수도 있고, **여러 칸(예: 2×2)** 일 수도 있음.
- **위치**: `position` = 기준점(예: 상단·좌측 칸).
- **크기**: `size: { width, height }` (없으면 1×1).
- **점유 칸**: `position`부터 `width×height` 칸을 차지. 회전 시에도 점유 영역은 동일하게 유지(회전은 입출력 방향만 영향).
- 배치 시 **다른 장비와 겹치지 않도록** 검사 필요.

---

## 3. 장비 입출력 포트 표현

- **장비 종류별 스펙**으로 정의:
  - **크기** (width, height)
  - **입력**: 어느 변(면)에 몇 개 포트인지. 예: `inputSide: 180`(좌측), `inputPortCount: 2`
  - **출력**: 반대쪽 변 등. 예: `outputSide: 0`(우측), `outputPortCount: 2`
- **방향(rotation)**에 따라, 실제 그리드에서 “어느 셀들이 입력/출력”인지는 **스펙(inputSide/outputSide, 포트 수) + position + size + rotation**으로 계산. (`src/data/equipmentSpecs.ts` 참고.)
- **컨베이어**: 1칸, 입출력은 각각 `inputDirection` / `rotation`(출력) 한 개씩.
- **기계1**: 2×2, 한쪽 변 2입력·반대쪽 2출력 → 스펙으로 “어느 변이 입력/출력, 포트 수”만 정의하고, 좌표는 계산.

---

## 4. 출고 → 입고 순서 (창고 연결)

- **출고**
  - 창고와 연결.
  - **출고 포트(버튼)에서 “창고에 있는 물품 중 어떤 것을 이 포트로 내보낼지” 선택.**
  - 선택한 품목만 해당 출고 포트에서 주기적으로 출력.
- **입고**
  - **어떤 물품이든 입고에 들어오면 창고로 적재.**
- **창고**
  - 입고에서 받은 물품을 보관.
  - 출고 포트는 “창고에서 선택된 품목만” 가져가서 출력.
- 구조/UI 상 **출고(창고 물품 선택) → 입고(창고로 들어감)** 순서로 정의·표현.

---

## 5. 데이터 구조 요약

| 구분 | 내용 |
|------|------|
| **PlacedEquipment** | position, size?(다칸), rotation, inputDirection?(컨베이어), **outboundSelectedItem?**(출고 시 창고에서 선택한 품목) |
| **장비 종류별 스펙** | size, inputSide, inputPortCount, outputSide, outputPortCount (기계 등) |
| **Layout / 슬롯** | **warehouseInventory?** (창고 보유량), equipment[] |
| **방향전환** | 한 셀에서 진입 방향 ≠ 이탈 방향 (컨베이어 inputDirection ≠ rotation) |

---

이 구조를 기준으로 타입·스펙을 두고, **Phase 1에서 흐름 규칙(flow 엔진)을 테스트와 시뮬이 공유하도록** 완성한 뒤, Phase 2에서 시간·지표·UI를 붙입니다.
