# Factory Simulator v1 작업 명세서

## 0. 목적

본 문서는 격자 기반 공장 시뮬레이터의 1차 구현을 위한 기술 명세와 프로젝트 접근 방법을 정의한다. 배치, 이동, 전력, 생산 로직의 최소 완성도를 목표로 하며 이후 확장 요소를 고려한 구조를 채택한다.

---

## 1. 공간 구조

### 1.1 Zone

- Zone은 직사각 격자 공간
- 현재 Zone 구성
  - Z1: 70 x 70
  - Z2: 40 x 40
  - Z3: 40 x 40
- Zone은 독립된 배치 공간이나 동일 Warehouse를 공유
- Zone은 이후 N개로 확장 가능해야 함

### 1.2 Cell

- 기본 단위는 1 x 1 Cell
- Cell 상태
  - Empty
  - Conveyor
  - Machine 영역
  - Power Provider 영역
- 포트는 Cell을 점유하지 않는 논리적 접점 개념

### 1.3 좌표계

- 각 Zone 내부 좌표계
  - x: 0 \~ width-1
  - y: 0 \~ height-1
- 좌하단 원점 기준을 기본으로 채택

---

## 2. 물류라인 및 창고

### 2.1 Warehouse

- 모든 Zone이 하나의 Warehouse 인스턴스를 공유
- Warehouse는 품목별 재고를 관리
  - inventory[item\_id] = int

### 2.2 물류라인

- 물류라인은 Zone 외부에 존재
- Zone 좌측 외부 및 하단 외부에 각각 배치됨
- 물류라인은 격자에 포함되지 않으며 포트 장치가 부착되는 기반 구조물로 취급

### 2.3 창고 입출력 포트

- 포트는 장치이며 크기 1 x 3
- 1 x 3은 물류라인에 접촉하는 길이가 3이라는 의미
- 포트 장치는 Zone 외부에 위치하며 내부 컨베이어와 접속됨

#### 입력 포트

- 컨베이어에서 들어온 아이템을 즉시 Warehouse로 입고
- 입고 후 포트 내부는 비워짐

#### 출력 포트

- 특정 item\_id를 지정
- 포트가 비어 있을 경우 Warehouse에서 아이템을 출고
- 1 x 3 크기의 출력 포트는 중앙에 1개의 부분에서만 라인이 연결됨.

---

## 3. 컨베이어 시스템

### 3.1 컨베이어 벨트

- 크기 1 x 1
- 방향 보유 상 하 좌 우
- 하나의 Cell에는 아이템 1개만 존재 가능

### 3.2 이동 규칙

- 아이템 이동 속도는 2초당 1칸
- tick 기반 시뮬레이션
- 다음 Cell이 비어 있으면 이동
- 차 있으면 대기

### 3.3 연결 규칙

- 컨베이어 간 직접 연결은 허용하지 않음
- 분기 합류 교차 모두 불가
- 이후 브릿지 분배기 합류기 등의 별도 장치로 확장 예정

### 3.4 이동 처리 방식

- tick 단위 2단계 처리
  1 이동 의사결정
  2 충돌 없는 이동만 적용

---

## 4. 기계 시스템

### 4.1 공통 규칙

- 모든 기계는 회전 가능
- 기계는 직사각 영역을 점유
- 입력 출력 포트는 기계 크기 내부 개념
- 입력 포트는 좌측 면 출력 포트는 우측 면 기준
- 회전 시 입력 출력 면도 함께 회전됨

### 4.2 기초 생산 기계

- 정련로 3 x 3 입력 3 출력 3
- 분쇄기 3 x 3 입력 3 출력 3
- 부품가공기 3 x 3 입력 3 출력 3
- 성형기 3 x 3 입력 3 출력 3
- 씨앗 추출기 5 x 5 입력 5 출력 5
- 재배기 5 x 5 입력 5 출력 5

### 4.3 합성 생산 기계

- 장비 부품 생성기 4 x 6 입력 6 출력 6
- 충진기 4 x 6 입력 6 출력 6
- 포장기 4 x 6 입력 6 출력 6
- 연마기 4 x 6 입력 6 출력 6

### 4.4 레시피

- 각 기계 타입은 복수 레시피 보유
- 플레이어가 기계별로 활성 레시피 선택
- 레시피 구성
  - inputs item\_id 수량
  - outputs item\_id 수량
  - process\_time\_sec

### 4.5 버퍼

- 기계 입력 버퍼 크기 50
- 출력 버퍼도 동일하게 50으로 설정

### 4.6 생산 흐름

1 입력 버퍼가 레시피 조건 충족 시 작업 시작
2 작업 시간 누적
3 완료 시 출력 버퍼에 결과물 적재
4 출력 방향 컨베이어가 비어 있으면 배출

---

## 5. 전력 시스템

### 5.1 전력공급기

- 크기 2 x 2
- 중심 기준 12 x 12 범위 전력 공급
- 예시
  - 공급기 중심이 F6 G7 위치
  - 전력 범위는 A1 \~ L12

### 5.2 전력 판정

- 기계 점유 영역 중 하나라도 전력 범위에 포함되면 powered true
- 전력이 없는 기계는 생산 진행 중단
- 입력은 허용 출력은 중단

---

## 6. 시간 모델

### 6.1 Tick

- 기본 tick\_sec 0.5초
- 컨베이어 이동 주기 4 tick

### 6.2 Tick 처리 순서

1 창고 출력 포트 출고
2 컨베이어 이동
3 기계 입력 흡입
4 기계 생산 진행
5 기계 출력 배출
6 창고 입력 포트 입고

---

## 7. 데이터 구조 초안

### World

- zones list
- warehouse
- current\_tick

### Zone

- width height
- grid
- conveyors machines power\_providers ports

### Machine

- type\_id
- rect
- rotation
- recipe
- in\_buffer out\_buffer
- powered progress

---

## 8. 프로젝트 접근 단계

### Phase 1

- Zone 배치 시스템
- 컨베이어 단방향 이동
- 창고 입출력 포트

### Phase 2

- 기계 생산 로직
- 전력 범위 판정

### Phase 3

- 레시피 UI 및 선택
- 생산량 검증 및 병목 확인

### Phase 4

- 분배기 합류기 브릿지 확장
- 다중 Zone 최적화

---

본 명세서는 구현 기준 문서이며 이후 확장 요소는 본 구조를 유지한 상태에서 타일 및 엔티티 추가로 진행한다.

